
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Assignment 3: Neural Network By Hand! &#8212; Machine Learning in Particle Physics</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Machine Learning in Particle Physics</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Machine Learning in Particle Physics
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  About this course
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../about/learningoutcomes.html">
   Learning outcomes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about/instructor.html">
   Instructor &amp; Schedule
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about/jupyter.html">
   JupyterHub for class
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about/evaluation.html">
   Evaluation
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Week 1
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../week1/trailer.html">
   1. Course Trailer
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../week1/trailer_hep.html">
     From detectors to publications
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../week1/trailer_mldef.html">
     What is Machine Learning?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../week1/trailer_pb.html">
     Which problems does ML solve?
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../week1/warmup_1D.html">
   2. Warm up: Linear Regression
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../week1/warmup_1D_linRegGD.html">
     Gradient Descent in 1D
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../week1/warmup_1D_linRegGDmulti.html">
     Multivariate linear regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../week1/warmup_1D_learningR.html">
     Learning Rate
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../week1/warmup_1D_practice.html">
     Gradient Descent in practice
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../week1/class_algs.html">
   3. Classification algorithms
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../week1/class_algs_logReg.html">
     Logistic Regression: introduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../week1/class_algs_sigmoid.html">
     What is the Sigmoid Function?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../week1/class_algs_costF.html">
     Cost Function for Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../week1/class_algs_reg.html">
     Regularization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../week1/class_algs_biasV.html">
     Performance Metrics
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../week1/BDTs.html">
   4. Decision Trees and Boosting
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../week1/BDTs_def.html">
     What are Decision Trees?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../week1/BDTs_forest.html">
     Ensemble Learning and Random Forests
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../week1/BDTs_boosting.html">
     What is boosting?
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week1/review_week1.html">
   5. Review Week 1
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Week 2
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../week2/NN1.html">
   6. Neural Networks Part I
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../week2/NN1_motivations.html">
     Motivations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../week2/NN1_modelRep.html">
     Model Representation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../week2/NN1_activationF.html">
     Activation Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../week2/NN1_feedforward.html">
     Feedforward Propagation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../week2/NN2.html">
   7. Neural Networks Part II
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../week2/NN2_costF.html">
     Neural Network Loss Function
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../week2/NN2_init.html">
     Initialization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../week2/NN2_backprop.html">
     Backpropagation Algorithm
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../week2/DL.html">
   8. Towards Deep Learning Models
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../week2/DL_stochGD.html">
     Stochastic Gradient Descent
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../week2/DL_adaptLR.html">
     Varying the Learning Rate
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../week2/DL_paramHyper.html">
     Hyperparameters in DL
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../week2/DL_trainNN.html">
     Let’s train our NN!
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../week2/CNN.html">
   9. Convolutional Neural Networks
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../week2/CNN_resources.html">
     Learn CNNs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../week2/CNN_guest.html">
     Guest Lecture
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week2/review_week2.html">
   10. Review Week 2
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Week 3
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../week3/unsupervised_learning.html">
   11. Unsupervised Learning Part I
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../week3/unsupervised_learning_overview.html">
     Overview
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../week3/unsupervised_learning_k-Means.html">
     k-Means Clustering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../week3/unsupervised_learning_dimRed.html">
     Dimensionality Reduction
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../week3/unsupervised_learning2.html">
   12. Unsupervised Learning Part II
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../week3/unsupervised_learning2_autoEncoder.html">
     Autoencoders
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../week3/unsupervised_learning2_VAE_for_AD.html">
     Variational Autoencoder for Anomaly Detection
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../week3/ML_BigData.html">
   13. Big Data &amp; ML Strategies
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../week3/ML_BigData_7Vs.html">
     Big Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../week3/ML_BigData_strategies.html">
     Strategies in Machine Learning
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../week3/ethics_outlook.html">
   14. Ethics in ML &amp; Outlook
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../week3/ethics_outlook_1.html">
     Ethics in ML
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../week3/ethics_outlook_2.html">
     Outlook
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week3/projects_exam.html">
   15. Project presentations &amp; Exam
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tutorials
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../tutorials/t01_linear_regression.html">
   1. Linear Regression in Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tutorials/t02_forestry.html">
   2. ‘Forestree’ with LHC collisions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tutorials/t03_class_game.html">
   3. Classification Contest
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tutorials/t04_anomaly_detection.html">
   4. Anomaly Detection
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/executablebooks/jupyter-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fassignments/ml_a3.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/assignments/ml_a3.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   0. Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get-the-data">
   1. Get the data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#functions">
   2. Functions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#feedforward">
   3. Feedforward
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#neural-network-training">
   4. Neural Network Training
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plots">
   5. Plots
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Assignment 3: Neural Network By Hand!</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   0. Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get-the-data">
   1. Get the data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#functions">
   2. Functions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#feedforward">
   3. Feedforward
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#neural-network-training">
   4. Neural Network Training
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plots">
   5. Plots
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="assignment-3-neural-network-by-hand">
<h1>Assignment 3: Neural Network By Hand!<a class="headerlink" href="#assignment-3-neural-network-by-hand" title="Permalink to this headline">#</a></h1>
<p>In this assignment, you will code a little neural network from scratch! Don’t worry, it will be extremely guided. The two most important points being that you learn and you have fun.</p>
<p>We want our neural network to solve the XOR problem. This is how the data look like:</p>
<figure class="align-default" id="a03-data">
<a class="reference internal image-reference" href="../_images/a03_data.png"><img alt="../_images/a03_data.png" src="../_images/a03_data.png" style="width: 70%;" /></a>
<figcaption>
<p><span class="caption-text">Scatter plot of data representing the XOR configuration: it is not linearly separable.</span><a class="headerlink" href="#a03-data" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<section id="setup">
<h2>0. Setup<a class="headerlink" href="#setup" title="Permalink to this headline">#</a></h2>
<p>Copy all of the following into a fresh Jupyter notebook.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">FONTSIZE</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
         <span class="s1">&#39;figure.figsize&#39;</span> <span class="p">:</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
         <span class="s1">&#39;axes.labelsize&#39;</span> <span class="p">:</span> <span class="n">FONTSIZE</span><span class="p">,</span>
         <span class="s1">&#39;axes.titlesize&#39;</span> <span class="p">:</span> <span class="n">FONTSIZE</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span>
         <span class="s1">&#39;legend.fontsize&#39;</span><span class="p">:</span> <span class="n">FONTSIZE</span><span class="p">,</span>
         <span class="s1">&#39;xtick.labelsize&#39;</span><span class="p">:</span> <span class="n">FONTSIZE</span><span class="p">,</span>
         <span class="s1">&#39;ytick.labelsize&#39;</span><span class="p">:</span> <span class="n">FONTSIZE</span><span class="p">,</span>
         <span class="s1">&#39;xtick.color&#39;</span>    <span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
         <span class="s1">&#39;ytick.color&#39;</span>    <span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
         <span class="s1">&#39;axes.facecolor&#39;</span> <span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span>
         <span class="s1">&#39;axes.edgecolor&#39;</span> <span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
         <span class="s1">&#39;axes.titlepad&#39;</span>  <span class="p">:</span>  <span class="mi">20</span><span class="p">,</span>
         <span class="s1">&#39;axes.labelpad&#39;</span>  <span class="p">:</span>  <span class="mi">10</span><span class="p">}</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

<span class="n">XNAME</span> <span class="o">=</span> <span class="s1">&#39;x1&#39;</span><span class="p">;</span> <span class="n">XLABEL</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$x_1$&#39;</span>
<span class="n">YNAME</span> <span class="o">=</span> <span class="s1">&#39;x2&#39;</span><span class="p">;</span> <span class="n">YLABEL</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$x_2$&#39;</span>
<span class="n">RANGE</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span> <span class="n">STEP</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">output_node</span><span class="p">,</span> <span class="n">boundary_value</span><span class="p">):</span>
  <span class="n">output_node</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># a list (m, 1, 1)</span>
  <span class="n">predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output_node</span> <span class="o">&gt;</span> <span class="n">boundary_value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">predictions</span>

<span class="k">def</span> <span class="nf">plot_cost_vs_iter</span><span class="p">(</span><span class="n">train_costs</span><span class="p">,</span> <span class="n">test_costs</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Cost evolution&quot;</span><span class="p">):</span>

  <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
  <span class="n">iters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">train_costs</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">iters</span><span class="p">,</span> <span class="n">train_costs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Training set&#39;</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">iters</span><span class="p">,</span> <span class="n">test_costs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Testing set&#39;</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Number of iterations&quot;</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">iters</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Cost&quot;</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">get_decision_surface</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">biases</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="n">RANGE</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">STEP</span><span class="p">):</span>

  <span class="c1"># Create a grid of points spanning the parameter space:</span>
  <span class="n">x1v</span><span class="p">,</span> <span class="n">x2v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">step</span><span class="p">,</span> <span class="n">step</span><span class="p">),</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">step</span><span class="p">,</span> <span class="n">step</span><span class="p">))</span>
  
  <span class="c1"># Stack it so that it is shaped like X_train: (m,2)</span>
  <span class="n">X_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">x1v</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">x2v</span><span class="o">.</span><span class="n">ravel</span><span class="p">()]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

  <span class="c1"># Feedforward on all grid points and get binary predictions:</span>
  <span class="n">output</span> <span class="o">=</span> <span class="n">feedforward</span><span class="p">(</span><span class="n">X_grid</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">biases</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># getting only output node</span>
  <span class="n">Ypred_grid</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">boundary</span><span class="p">)</span>

  <span class="k">return</span> <span class="p">(</span><span class="n">x1v</span><span class="p">,</span> <span class="n">x2v</span><span class="p">,</span> <span class="n">Ypred_grid</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x1v</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">plot_scatter</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">bkg</span><span class="p">,</span> <span class="n">ds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xname</span><span class="o">=</span><span class="n">XNAME</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">XLABEL</span><span class="p">,</span> <span class="n">yname</span><span class="o">=</span><span class="n">YNAME</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">YLABEL</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="n">RANGE</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">STEP</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Scatter plot&quot;</span><span class="p">):</span>

  <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

  <span class="c1"># Decision surface</span>
  <span class="k">if</span> <span class="n">ds</span><span class="p">:</span>
    <span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">Z</span><span class="p">)</span> <span class="o">=</span> <span class="n">ds</span> <span class="c1"># unpack contour data</span>
    <span class="n">cs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

  <span class="c1"># Scatter signal and background:</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">sig</span><span class="p">[</span><span class="n">xname</span><span class="p">],</span> <span class="n">sig</span><span class="p">[</span><span class="n">yname</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Positive class&#39;</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">bkg</span><span class="p">[</span><span class="n">xname</span><span class="p">],</span> <span class="n">bkg</span><span class="p">[</span><span class="n">yname</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span>     <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Negative class&#39;</span><span class="p">)</span>

  <span class="c1"># Axes, legend and plot:</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">range</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="nb">range</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

  <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.04</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center left&quot;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 
  <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="get-the-data">
<h2>1. Get the data<a class="headerlink" href="#get-the-data" title="Permalink to this headline">#</a></h2>
<p><strong>1.1: Get the data file</strong><br />
Retrieve the files of <a class="reference external" href="https://drive.google.com/drive/folders/1qJaNCiZ6FTOltLuOoMU1sZWmNtgbxlcN?usp=sharing">this folder</a> and read them into dataframes <code class="docutils literal notranslate"><span class="pre">train</span></code> and <code class="docutils literal notranslate"><span class="pre">test</span></code>.</p>
<ul class="simple">
<li><p>How many samples are there in each? Write a full sentence to express your answer.</p></li>
<li><p>What is the name of the column containing the labels? What are the class values?</p></li>
</ul>
<p><strong>1.2: Split signal vs background</strong><br />
Create a <code class="docutils literal notranslate"><span class="pre">sig</span></code> and <code class="docutils literal notranslate"><span class="pre">bkg</span></code> dataframes that collect the real signal and value samples.<br />
<em>Hint: this has been done in Tutorial 2.</em></p>
<p><strong>1.3: Dataframe to NumPy</strong><br />
Declare the following variables to store the dataset into NumPy arrays:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">,</span> <span class="s1">&#39;x2&#39;</span><span class="p">]</span>
<span class="n">X_train</span> <span class="o">=</span> 
<span class="n">y_train</span> <span class="o">=</span> 

<span class="n">X_test</span> <span class="o">=</span> 
<span class="n">y_test</span> <span class="o">=</span> 
</pre></div>
</div>
</section>
<section id="functions">
<h2>2. Functions<a class="headerlink" href="#functions" title="Permalink to this headline">#</a></h2>
<p><strong>2.1: Weighted Sum</strong><br />
Create the function <code class="docutils literal notranslate"><span class="pre">z</span></code> that compute the weighted sum of a given activation unit, as seen in class. You do not have to worry about the dimensions of objects here, this will come later. Make sure the names of the arguments are self-explanatory:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">z</span><span class="p">(</span> <span class="o">...</span> <span class="p">,</span> <span class="o">...</span> <span class="p">,</span> <span class="o">...</span> <span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="k">return</span> <span class="c1">#...</span>
</pre></div>
</div>
<p><strong>2.2: Activation Functions and Derivatives</strong><br />
Write the hyperbolic tan and sigmoid activation functions, followed by their derivatives:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">tanh</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
    <span class="k">return</span> <span class="c1">#... </span>

<span class="k">def</span> <span class="nf">sigmoid</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
    <span class="k">return</span> <span class="c1">#... </span>

<span class="k">def</span> <span class="nf">sigmoid_prime</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
    <span class="k">return</span> <span class="c1">#... </span>

<span class="k">def</span> <span class="nf">tanh_prime</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
    <span class="k">return</span> <span class="c1">#... </span>
</pre></div>
</div>
<p><strong>2.3: Cross-entropy cost function</strong><br />
Write the cross-entropy cost function.<br />
<em>Hint: It was done in assignment 1</em></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cross_entropy_cost</span><span class="p">(</span><span class="n">y_preds</span><span class="p">,</span> <span class="n">y_vals</span><span class="p">):</span>
    <span class="c1">#... </span>
    <span class="k">return</span> <span class="c1">#... </span>
</pre></div>
</div>
<p><strong>2.4: Derivative of the Loss</strong><br />
As seen in class, the loss function for classification is defined as:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
L\left( \hat{y}^{(i)}, y^{(i)}\right) = - \left[ \;\; y^{(i)} \log\left( \hat{y}^{(i)} \right) \;\;+\;\; \left(1- y^{(i)}\right) \log\left( 1 - \hat{y}^{(i)} \right) \;\;\right]
\end{equation*}\]</div>
<p>Find the expression of:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\frac{\mathrm{d} }{\mathrm{d} \hat{y}^{(i)}} L\left( \hat{y}^{(i)}, y^{(i)}\right) = \cdots
\end{equation*}\]</div>
<p>Use a text cell and LaTeX. If you are new to LaTeX, this <a class="reference external" href="https://editor.codecogs.com/">application</a> will help.</p>
<p>Once you have an expression for the derivative of the loss, code it in python:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">L_prime</span><span class="p">(</span><span class="n">y_preds</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">):</span>
    <span class="k">return</span> <span class="c1">#...</span>
</pre></div>
</div>
</section>
<section id="feedforward">
<h2>3. Feedforward<a class="headerlink" href="#feedforward" title="Permalink to this headline">#</a></h2>
<p>It is time to write the feedforward function! Some information about the network:</p>
<ul class="simple">
<li><p>The network has two hidden layers</p></li>
<li><p>The nodes of the hidden layers use the hyperbolic tangent as activation function</p></li>
<li><p>The output layer uses the sigmoid function</p></li>
</ul>
<p><strong>3.1: Feedforward Propagation</strong><br />
We do not have to know the number of activation units in each layer as the code here is made to be general. The weights and biases are given as input, stored in lists. Again, you do not have to worry about the indices yet (and I have simplified it by reshaping the input data for you).</p>
<p>Complete the function below that does the feedforward propagation of the network, using the equations shown in class. Look at the output to see how to name your variables!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">feedforward</span><span class="p">(</span><span class="n">input_X</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">biases</span><span class="p">):</span>

  <span class="n">W1</span><span class="p">,</span> <span class="n">W2</span><span class="p">,</span> <span class="n">W3</span> <span class="o">=</span> <span class="n">weights</span> <span class="p">;</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">b3</span> <span class="o">=</span> <span class="n">biases</span>

  <span class="n">m</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_X</span><span class="p">)</span> 
  <span class="n">a0</span> <span class="o">=</span> <span class="n">input_X</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">m</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

  <span class="c1"># First layer</span>
  <span class="c1">#...</span>
  <span class="c1">#...</span>

  <span class="c1"># Second layer</span>
  <span class="c1">#...</span>
  <span class="c1">#...</span>

  <span class="c1"># Third layer</span>
  <span class="c1">#...</span>
  <span class="c1">#...</span>
  
  <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">a0</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">z3</span><span class="p">,</span> <span class="n">a3</span><span class="p">]</span>

  <span class="k">return</span> <span class="n">nodes</span>
</pre></div>
</div>
<div class="note admonition">
<p class="admonition-title">Check Point</p>
<p>At that point in the assignment, it is possible to ask for a checkup with the instructor before moving forward to …the backward pass (pun intended).
Send an email to the instruction with the exact title “[Machine Learning Course] Assignment 3 Check 1” where you paste the code of the function above (do not send any notebook).</p>
</div>
<p><strong>3.2: Predict</strong></p>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<p>To insert a code block within a text cell in Jupyter notebook, write:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   ```python
   # your code here

   ```
</pre></div>
</div>
</aside>
<p>This function is given (at the Setup step), yet there is a question for you:</p>
<ul class="simple">
<li><p>What is the <code class="docutils literal notranslate"><span class="pre">output_node</span></code> in the context of our 2-hidden-layered neural network?</p></li>
<li><p>What type of values does the function <code class="docutils literal notranslate"><span class="pre">predict</span></code> return?</p></li>
<li><p>After successfully executing the <code class="docutils literal notranslate"><span class="pre">feedforward</span></code> function, how would you call the function <code class="docutils literal notranslate"><span class="pre">predict</span></code>?</p></li>
</ul>
</section>
<section id="neural-network-training">
<h2>4. Neural Network Training<a class="headerlink" href="#neural-network-training" title="Permalink to this headline">#</a></h2>
<p>Time to train! The code below is a skeleton. You will have to complete it. To help you further, hyperparameters are given. You should replace the <code class="docutils literal notranslate"><span class="pre">#...</span></code> with your own code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Hyperparameters</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.03</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c1"># epochs</span>

<span class="c1"># Initialization </span>
<span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>     <span class="c1"># number of data samples</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># number of input features</span>
<span class="n">q</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># number of nodes in first hidden layer</span>
<span class="n">r</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># number of nodes in second hidden layer</span>

<span class="c1"># WEIGHT MATRICES + BIASES</span>
<span class="n">W1</span> <span class="o">=</span>  <span class="c1">#... </span>
<span class="n">W2</span> <span class="o">=</span>  <span class="c1">#... </span>
<span class="n">W3</span> <span class="o">=</span>  <span class="c1">#... </span>
<span class="n">b1</span> <span class="o">=</span>  <span class="c1">#... </span>
<span class="n">b2</span> <span class="o">=</span>  <span class="c1">#... </span>
<span class="n">b3</span> <span class="o">=</span>  <span class="c1">#... </span>

<span class="c1"># OUTPUT LAYER</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">y_test</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">y_test</span> <span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># Storing cost values for train and test datasets</span>
<span class="n">costs_train</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">costs_test</span>  <span class="o">=</span> <span class="p">[]</span>
<span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting the training</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># -------------------</span>
<span class="c1">#   Start iterations</span>
<span class="c1"># -------------------</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>

  <span class="c1"># FORWARD PROPAGATION</span>
  <span class="c1"># Feedforward on test data:</span>
  <span class="n">nodes_test</span> <span class="o">=</span>  <span class="c1">#... </span>
  <span class="n">ypreds_test</span> <span class="o">=</span>  <span class="c1">#... </span>

  <span class="c1"># Feedforward on train data:</span>
  <span class="n">a0</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">z3</span><span class="p">,</span> <span class="n">a3</span> <span class="o">=</span> <span class="c1">#... </span>
  <span class="n">ypreds_train</span> <span class="o">=</span>  <span class="c1">#... </span>

  <span class="c1"># Cost computation and storage</span>
  <span class="n">J_train</span> <span class="o">=</span> <span class="n">cross_entropy_cost</span><span class="p">(</span><span class="n">ypreds_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
  <span class="n">J_test</span>  <span class="o">=</span> <span class="n">cross_entropy_cost</span><span class="p">(</span><span class="n">ypreds_test</span><span class="p">,</span>  <span class="n">y_test</span> <span class="p">)</span>
  <span class="n">costs_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">J_train</span><span class="p">)</span>
  <span class="n">costs_test</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">J_test</span><span class="p">)</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">t</span><span class="o">&lt;=</span><span class="mi">100</span> <span class="ow">and</span> <span class="n">t</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">t</span><span class="o">&gt;</span><span class="mi">100</span> <span class="ow">and</span> <span class="n">t</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
      <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Iteration </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="se">\t</span><span class="s2"> Train cost = </span><span class="si">{</span><span class="n">J_train</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">  Test cost = </span><span class="si">{</span><span class="n">J_test</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">   Diff = </span><span class="si">{</span><span class="n">J_test</span><span class="o">-</span><span class="n">J_train</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

  <span class="c1"># BACKWARD PROPAGATION</span>
  <span class="c1"># Errors delta:</span>
  <span class="n">delta_3</span> <span class="o">=</span> <span class="c1">#...</span>
  <span class="n">delta_2</span> <span class="o">=</span> <span class="c1">#...</span>
  <span class="n">delta_1</span> <span class="o">=</span> <span class="c1">#...</span>
  
  <span class="c1"># Partial derivatives:</span>
  <span class="n">dCostdW3</span> <span class="o">=</span> <span class="c1">#...</span>
  <span class="n">dCostdW2</span> <span class="o">=</span> <span class="c1">#...</span>
  <span class="n">dCostdW1</span> <span class="o">=</span> <span class="c1">#...</span>
  <span class="n">dCostdb3</span> <span class="o">=</span> <span class="c1">#...</span>
  <span class="n">dCostdb2</span> <span class="o">=</span> <span class="c1">#...</span>
  <span class="n">dCostdb1</span> <span class="o">=</span> <span class="c1">#...</span>

  <span class="k">if</span> <span class="n">debug</span> <span class="ow">and</span> <span class="n">t</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;a0: </span><span class="si">{</span><span class="n">a0</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> a1: </span><span class="si">{</span><span class="n">a1</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> a2: </span><span class="si">{</span><span class="n">a2</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> a3: </span><span class="si">{</span><span class="n">a3</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;W3: </span><span class="si">{</span><span class="n">W3</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> z1: </span><span class="si">{</span><span class="n">z1</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> z2: </span><span class="si">{</span><span class="n">z2</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> z3: </span><span class="si">{</span><span class="n">z3</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dCostdW3: </span><span class="si">{</span><span class="n">dCostdW3</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> dCostdW2: </span><span class="si">{</span><span class="n">dCostdW2</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> dCostdW1: </span><span class="si">{</span><span class="n">dCostdW1</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> 

  <span class="c1"># Update of weights and biases</span>
  <span class="n">W3</span> <span class="o">=</span> <span class="c1">#... </span>
  <span class="n">W2</span> <span class="o">=</span> <span class="c1">#... </span>
  <span class="n">W1</span> <span class="o">=</span> <span class="c1">#... </span>
  <span class="n">b3</span> <span class="o">=</span> <span class="c1">#...  </span>
  <span class="n">b2</span> <span class="o">=</span> <span class="c1">#...  </span>
  <span class="n">b1</span> <span class="o">=</span> <span class="c1">#... </span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">End of gradient descent after </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1"> iterations&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Hints (lots of)</p>
<p><strong>Hints on weight initialization</strong></p>
<p>The weight matrices and bias vectors can be simply initialized with a random number between 0 and 1. Use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">an_i_by_j_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span> <span class="n">i</span> <span class="p">,</span> <span class="n">j</span> <span class="p">))</span>
</pre></div>
</div>
<p>The double parenthesis is important to get the correct shape. To make your code modular, use the variables encoding the number of activation nodes on the first and second hidden layers.</p>
<p><strong>Feedforward and predict</strong></p>
<ul class="simple">
<li><p>To return the last element of a list: <code class="docutils literal notranslate"><span class="pre">my_list[-1]</span></code></p></li>
</ul>
<p><strong>Dimension of Nodes</strong><br />
At the end of the lecture on <a class="reference internal" href="../week2/NN2_backprop.html#nn2-backprop"><span class="std std-ref">Backpropagation Algorithm</span></a>, the equations are written with the indices. In python, we will use 3D NumPy arrays of shape (<span class="math notranslate nohighlight">\(i\)</span>, <span class="math notranslate nohighlight">\(j\)</span>, <span class="math notranslate nohighlight">\(k\)</span>), with</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(i\)</span> the sample index</p></li>
<li><p><span class="math notranslate nohighlight">\(j\)</span> the number of rows of the node vector</p></li>
<li><p><span class="math notranslate nohighlight">\(k\)</span> the number of columns</p></li>
</ul>
<p><strong>Matrix/Vector Operations</strong></p>
<ul class="simple">
<li><p>In python the matrix multiplication is done using <code class="docutils literal notranslate"><span class="pre">&#64;</span></code></p></li>
<li><p>The element-wise multiplication is done using <code class="docutils literal notranslate"><span class="pre">*</span></code></p></li>
</ul>
<p><strong>Transpose</strong></p>
<ul class="simple">
<li><p>To transpose a matrix M: <code class="docutils literal notranslate"><span class="pre">M.T</span></code></p></li>
<li><p>To transpose 3D arrays, the indices to reorder are indicated as argument: <code class="docutils literal notranslate"><span class="pre">np.transpose(my3Darray,</span> <span class="pre">(0,</span> <span class="pre">2,</span> <span class="pre">1))</span></code> will transpose the two last dimensions.</p></li>
</ul>
<p><strong>Summing</strong></p>
<ul class="simple">
<li><p>To sum a 3D array on the first index: <code class="docutils literal notranslate"><span class="pre">np.sum(my3Darray,</span> <span class="pre">axis=0)</span></code></p></li>
</ul>
</div>
</section>
<section id="plots">
<h2>5. Plots<a class="headerlink" href="#plots" title="Permalink to this headline">#</a></h2>
<p><strong>5.1: Cost evolution</strong><br />
Call the provided function to plot the cost evolution of both the training and testing sets.</p>
<p><strong>5.2: Scatter Plot</strong><br />
Use the <code class="docutils literal notranslate"><span class="pre">get_decision_surface</span></code> and <code class="docutils literal notranslate"><span class="pre">plot_scatter</span></code> functions to visualize the decision boundaries of your trained neural network. Did your neural network successfully learn the XOR function?</p>
<p>If all goes well, you should obtain something like this:</p>
<figure class="align-default" id="a03-data-nn">
<a class="reference internal image-reference" href="../_images/a03_data_NN.png"><img alt="../_images/a03_data_NN.png" src="../_images/a03_data_NN.png" style="width: 90%;" /></a>
<figcaption>
<p><span class="caption-text">Scatter plot of data representing the XOR configuration: it is not linearly separable.</span><a class="headerlink" href="#a03-data-nn" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p> <br />
This assignment is individual. The instructor will be available to answer questions per email and/or during special session. If you are stuck, it is possible to get some elements of answer (at the cost of some mark, but not much) <strong>from the instructor only</strong>.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p> <br />
You can use the internet such as the official pages of relevant libraries, forum websites to debug, etc. You can use ChatGPT to help you locally with any python difficulties, but you cannot submit this entire assignment to the bot (and that will not even work).</p>
<p>The instructor and tutors are available throughout the week to answer your questions. Write an email with your well-articulated question(s). The more specific you are in your request, the best we can help you.</p>
<p>Thank you and do not forget to have fun while coding!</p>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./assignments"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Claire David<br/>
  
      &copy; Copyright 2022.<br/>
    <div class="extra_footer">
      <div>
<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://licensebuttons.net/l/by-nc-sa/3.0/88x31.png"></a>
    All content on this site (unless otherwise specified) is licensed under the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0 license</a>
</div>

    </div>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>